import { remote, ipcRenderer } from 'electron';
import { clipboard } from 'electron';
import React, { useEffect, useState } from 'react';
import { H4, Card, Label, InputGroup, FormGroup, Callout, Button } from '@blueprintjs/core';
import { useSetting } from '../../settings/renderer';
import { request } from '../../api/renderer';
import styles from './data-synchronizer.scss';
export const DataSynchronizer = function ({ upstreamURL, inPreLaunchSetup }) {
    const [username, setUsername] = useState('');
    const [name, setName] = useState('');
    const [email, setEmail] = useState('');
    const [repoConfigOpenState, updateRepoConfigOpenState] = useState(false);
    const [repoConfigComplete, updateRepoConfigComplete] = useState(false);
    const [repoCfg, updateRepoCfg] = useState({
        originURL: undefined,
        name: undefined,
        email: undefined,
        username: undefined,
    });
    const url = useSetting('gitRepoUrl', repoCfg.originURL || upstreamURL);
    const usingUpstream = url.value.trim() === upstreamURL.trim();
    let urlIsValid;
    try {
        new URL(url.value.trim());
        urlIsValid = true;
    }
    catch (e) {
        urlIsValid = false;
    }
    useEffect(() => {
        fetchRepoConfig();
    }, []);
    useEffect(() => {
        const _complete = (username.trim() !== '' &&
            name.trim() !== '' &&
            email.trim() !== '' &&
            urlIsValid);
        updateRepoConfigComplete(_complete);
        if (repoConfigOpenState === false && _complete === false) {
            updateRepoConfigOpenState(true);
        }
    }, [username, name, email, repoCfg.originURL]);
    if (name.trim() === '' && repoCfg.name) {
        setName(repoCfg.name);
    }
    if (email.trim() === '' && repoCfg.email) {
        setEmail(repoCfg.email);
    }
    if (username.trim() === '' && repoCfg.username) {
        setUsername(repoCfg.username);
    }
    const complete = (urlIsValid &&
        name.trim() != '' &&
        email.trim() != '' &&
        username.trim() != '');
    async function handleSaveAndClose() {
        await url.commit();
        await request('git-config-set', { name, email, username });
        closeWindow();
    }
    async function handleResetURL() {
        await ipcRenderer.send('clear-setting', 'gitRepoUrl');
        remote.app.relaunch();
        remote.app.exit(0);
    }
    async function copyUpstreamRepoURL() {
        clipboard.writeText(upstreamURL);
    }
    async function fetchRepoConfig() {
        const repoCfg = await request('git-config');
        updateRepoCfg(repoCfg);
    }
    function closeWindow() {
        remote.getCurrentWindow().hide();
    }
    return (React.createElement("div", { className: styles.dataSyncBase },
        React.createElement(Button, { disabled: !repoConfigComplete, onClick: () => updateRepoConfigOpenState(!repoConfigOpenState) },
            repoConfigComplete && repoConfigOpenState ? 'Hide r' : 'R',
            "epository configuration",
            !repoConfigOpenState && repoConfigComplete ? 'â€¦' : null),
        React.createElement(Card, { key: "repoUrl", className: styles.repoUrlCard },
            React.createElement(FormGroup, { label: "Repository URL", intent: inPreLaunchSetup && !urlIsValid ? "danger" : undefined, helperText: inPreLaunchSetup
                    ? React.createElement(Callout, { intent: "primary" },
                        React.createElement("p", null, "Please enter a valid URL of the repository you have commit access to, and which is a fork of the upstream repository."),
                        React.createElement("p", null,
                            React.createElement(Button, { onClick: copyUpstreamRepoURL }, "Copy upstream repository URL")))
                    : React.createElement(Callout, { intent: "warning" }, "Note: resetting the URL will cause you to lose any unsubmitted changes.") },
                React.createElement(InputGroup, { value: url.value, placeholder: upstreamURL, disabled: inPreLaunchSetup !== true, type: "text", onChange: inPreLaunchSetup
                        ? (evt) => {
                            url.set(evt.target.value);
                        }
                        : undefined, rightElement: inPreLaunchSetup
                        ? undefined
                        : React.createElement(Button, { intent: "danger", minimal: true, title: "Reset repository URL. Note: you will lose any unsubmitted changes.", onClick: handleResetURL }, "Reset URL") }))),
        React.createElement(Card, { key: "committerInfo", className: styles.committerInfoCard },
            React.createElement(H4, null, "Committing changes as"),
            React.createElement("div", { className: styles.dataSyncRow },
                React.createElement(Label, { key: "authorName" },
                    "Author name",
                    React.createElement(InputGroup, { value: name, type: "text", onChange: (evt) => {
                            setName(evt.target.value);
                        } })),
                React.createElement(Label, { key: "authorEmail" },
                    "Author email",
                    React.createElement(InputGroup, { value: email, type: "email", onChange: (evt) => {
                            setEmail(evt.target.value);
                        } })),
                React.createElement(Label, { key: "username" },
                    "Username",
                    React.createElement(InputGroup, { value: username, type: "text", onChange: (evt) => {
                            setUsername(evt.target.value);
                        } })))),
        React.createElement(Card, { key: "actionRow", className: styles.actionRowCard },
            React.createElement(Button, { className: "confirm-button", key: "confirm", intent: !usingUpstream ? "primary" : "warning", disabled: complete !== true, onClick: handleSaveAndClose },
                "Save ",
                !usingUpstream ? "upstream" : "fork",
                " configuration",
                inPreLaunchSetup ? " and launch" : " and close"))));
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YS1zeW5jaHJvbml6ZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvc3RvcmFnZS9yZW5kZXJlci9kYXRhLXN5bmNocm9uaXplci50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLE1BQU0sRUFBRSxXQUFXLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFDL0MsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUVyQyxPQUFPLEtBQUssRUFBRSxFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUUsTUFBTSxPQUFPLENBQUM7QUFDbkQsT0FBTyxFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBRTVGLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUNyRCxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFFN0MsT0FBTyxNQUFNLE1BQU0sMEJBQTBCLENBQUM7QUFlOUMsTUFBTSxDQUFDLE1BQU0sZ0JBQWdCLEdBQW9DLFVBQVUsRUFBRSxXQUFXLEVBQUUsZ0JBQWdCLEVBQUU7SUFDMUcsTUFBTSxDQUFDLFFBQVEsRUFBRSxXQUFXLENBQUMsR0FBRyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDN0MsTUFBTSxDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsR0FBRyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDckMsTUFBTSxDQUFDLEtBQUssRUFBRSxRQUFRLENBQUMsR0FBRyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUM7SUFFdkMsTUFBTSxDQUFDLG1CQUFtQixFQUFFLHlCQUF5QixDQUFDLEdBQUcsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3pFLE1BQU0sQ0FBQyxrQkFBa0IsRUFBRSx3QkFBd0IsQ0FBQyxHQUFH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SUFBSSxFQUFDLE9BQU8sRUFDWixRQUFRLEVBQUUsQ0FBQyxHQUFpQyxFQUFFLEVBQUU7NEJBQzlDLFFBQVEsQ0FBRSxHQUFHLENBQUMsTUFBMkIsQ0FBQyxLQUFlLENBQUMsQ0FBQzt3QkFDN0QsQ0FBQyxHQUNELENBQ0k7Z0JBRVIsb0JBQUMsS0FBSyxJQUFDLEdBQUcsRUFBQyxVQUFVOztvQkFFbkIsb0JBQUMsVUFBVSxJQUNULEtBQUssRUFBRSxRQUFRLEVBQ2YsSUFBSSxFQUFDLE1BQU0sRUFDWCxRQUFRLEVBQUUsQ0FBQyxHQUFpQyxFQUFFLEVBQUU7NEJBQzlDLFdBQVcsQ0FBRSxHQUFHLENBQUMsTUFBMkIsQ0FBQyxLQUFlLENBQUMsQ0FBQzt3QkFDaEUsQ0FBQyxHQUNELENBQ0ksQ0FDSixDQUNEO1FBRVAsb0JBQUMsSUFBSSxJQUFDLEdBQUcsRUFBQyxXQUFXLEVBQUMsU0FBUyxFQUFFLE1BQU0sQ0FBQyxhQUFhO1lBQ25ELG9CQUFDLE1BQU0sSUFDSCxTQUFTLEVBQUMsZ0JBQWdCLEVBQzFCLEdBQUcsRUFBQyxTQUFTLEVBQ2IsTUFBTSxFQUFFLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLFNBQVMsRUFDOUMsUUFBUSxFQUFFLFFBQVEsS0FBSyxJQUFJLEVBQzNCLE9BQU8sRUFBRSxrQkFBa0I7O2dCQUN2QixDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxNQUFNOztnQkFDekMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUN6QyxDQUNKLENBQ0gsQ0FDUCxDQUFDO0FBQ0osQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcmVtb3RlLCBpcGNSZW5kZXJlciB9IGZyb20gJ2VsZWN0cm9uJztcbmltcG9ydCB7IGNsaXBib2FyZCB9IGZyb20gJ2VsZWN0cm9uJztcblxuaW1wb3J0IFJlYWN0LCB7IHVzZUVmZmVjdCwgdXNlU3RhdGUgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBINCwgQ2FyZCwgTGFiZWwsIElucHV0R3JvdXAsIEZvcm1Hcm91cCwgQ2FsbG91dCwgQnV0dG9uIH0gZnJvbSAnQGJsdWVwcmludGpzL2NvcmUnO1xuXG5pbXBvcnQgeyB1c2VTZXR0aW5nIH0gZnJvbSAnLi4vLi4vc2V0dGluZ3MvcmVuZGVyZXInO1xuaW1wb3J0IHsgcmVxdWVzdCB9IGZyb20gJy4uLy4uL2FwaS9yZW5kZXJlcic7XG5cbmltcG9ydCBzdHlsZXMgZnJvbSAnLi9kYXRhLXN5bmNocm9uaXplci5zY3NzJztcblxuXG50eXBlIFJlcG9Db25maWcgPSB7XG4gIG9yaWdpblVSTDogc3RyaW5nIHwgbnVsbCB8IHVuZGVmaW5lZCxcbiAgbmFtZTogc3RyaW5nIHwgbnVsbCB8IHVuZGVmaW5lZCxcbiAgZW1haWw6IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQsXG4gIHVzZXJuYW1lOiBzdHJpbmcgfCBudWxsIHwgdW5kZWZpbmVkLFxufTtcblxuXG5pbnRlcmZhY2UgRGF0YVN5bmNocm9uaXplclByb3BzIHtcbiAgdXBzdHJlYW1VUkw6IHN0cmluZyxcbiAgaW5QcmVMYXVuY2hTZXR1cDogYm9vbGVhbixcbn1cbmV4cG9ydCBjb25zdCBEYXRhU3luY2hyb25pemVyOiBSZWFjdC5GQzxEYXRhU3luY2hyb25pemVyUHJvcHM+ID0gZnVuY3Rpb24gKHsgdXBzdHJlYW1VUkwsIGluUHJlTGF1bmNoU2V0dXAgfSkge1xuICBjb25zdCBbdXNlcm5hbWUsIHNldFVzZXJuYW1lXSA9IHVzZVN0YXRlKCcnKTtcbiAgY29uc3QgW25hbWUsIHNldE5hbWVdID0gdXNlU3RhdGUoJycpO1xuICBjb25zdCBbZW1haWwsIHNldEVtYWlsXSA9IHVzZVN0YXRlKCcnKTtcblxuICBjb25zdCBbcmVwb0NvbmZpZ09wZW5TdGF0ZSwgdXBkYXRlUmVwb0NvbmZpZ09wZW5TdGF0ZV0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gIGNvbnN0IFtyZXBvQ29uZmlnQ29tcGxldGUsIHVwZGF0ZVJlcG9Db25maWdDb21wbGV0ZV0gPSB1c2VTdGF0ZShmYWxzZSk7XG5cbiAgY29uc3QgW3JlcG9DZmcsIHVwZGF0ZVJlcG9DZmddID0gdXNlU3RhdGUoe1xuICAgIG9yaWdpblVSTDogdW5kZWZpbmVkLFxuICAgIG5hbWU6IHVuZGVmaW5lZCxcbiAgICBlbWFpbDogdW5kZWZpbmVkLFxuICAgIHVzZXJuYW1lOiB1bmRlZmluZWQsXG4gIH0gYXMgUmVwb0NvbmZpZyk7XG5cbiAgY29uc3QgdXJsID0gdXNlU2V0dGluZzxzdHJpbmc+KCdnaXRSZXBvVXJsJywgcmVwb0NmZy5vcmlnaW5VUkwgfHwgdXBzdHJlYW1VUkwpO1xuXG4gIGNvbnN0IHVzaW5nVXBzdHJlYW0gPSB1cmwudmFsdWUudHJpbSgpID09PSB1cHN0cmVhbVVSTC50cmltKCk7XG4gIGxldCB1cmxJc1ZhbGlkOiBib29sZWFuO1xuICB0cnkge1xuICAgIG5ldyBVUkwodXJsLnZhbHVlLnRyaW0oKSk7XG4gICAgdXJsSXNWYWxpZCA9IHRydWU7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB1cmxJc1ZhbGlkID0gZmFsc2U7XG4gIH1cblxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGZldGNoUmVwb0NvbmZpZygpO1xuICB9LCBbXSk7XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBjb25zdCBfY29tcGxldGUgPSAoXG4gICAgICB1c2VybmFtZS50cmltKCkgIT09ICcnICYmXG4gICAgICBuYW1lLnRyaW0oKSAhPT0gJycgJiZcbiAgICAgIGVtYWlsLnRyaW0oKSAhPT0gJycgJiZcbiAgICAgIHVybElzVmFsaWQpO1xuXG4gICAgdXBkYXRlUmVwb0NvbmZpZ0NvbXBsZXRlKF9jb21wbGV0ZSk7XG4gICAgaWYgKHJlcG9Db25maWdPcGVuU3RhdGUgPT09IGZhbHNlICYmIF9jb21wbGV0ZSA9PT0gZmFsc2UpIHtcbiAgICAgIHVwZGF0ZVJlcG9Db25maWdPcGVuU3RhdGUodHJ1ZSk7XG4gICAgfVxuICB9LCBbdXNlcm5hbWUsIG5hbWUsIGVtYWlsLCByZXBvQ2ZnLm9yaWdpblVSTF0pO1xuXG4gIGlmIChuYW1lLnRyaW0oKSA9PT0gJycgJiYgcmVwb0NmZy5uYW1lKSB7IHNldE5hbWUocmVwb0NmZy5uYW1lKTsgfVxuICBpZiAoZW1haWwudHJpbSgpID09PSAnJyAmJiByZXBvQ2ZnLmVtYWlsKSB7IHNldEVtYWlsKHJlcG9DZmcuZW1haWwpOyB9XG4gIGlmICh1c2VybmFtZS50cmltKCkgPT09ICcnICYmIHJlcG9DZmcudXNlcm5hbWUpIHsgc2V0VXNlcm5hbWUocmVwb0NmZy51c2VybmFtZSk7IH1cblxuICBjb25zdCBjb21wbGV0ZSA9IChcbiAgICB1cmxJc1ZhbGlkICYmXG4gICAgbmFtZS50cmltKCkgIT0gJycgJiZcbiAgICBlbWFpbC50cmltKCkgIT0gJycgJiZcbiAgICB1c2VybmFtZS50cmltKCkgIT0gJycpO1xuXG4gIGFzeW5jIGZ1bmN0aW9uIGhhbmRsZVNhdmVBbmRDbG9zZSgpIHtcbiAgICBhd2FpdCB1cmwuY29tbWl0KCk7XG4gICAgYXdhaXQgcmVxdWVzdDx7IGVycm9yczogc3RyaW5nW10gfT4oJ2dpdC1jb25maWctc2V0JywgeyBuYW1lLCBlbWFpbCwgdXNlcm5hbWUgfSk7XG4gICAgY2xvc2VXaW5kb3coKTtcbiAgfVxuXG4gIGFzeW5jIGZ1bmN0aW9uIGhhbmRsZVJlc2V0VVJMKCkge1xuICAgIGF3YWl0IGlwY1JlbmRlcmVyLnNlbmQoJ2NsZWFyLXNldHRpbmcnLCAnZ2l0UmVwb1VybCcpO1xuICAgIHJlbW90ZS5hcHAucmVsYXVuY2goKTtcbiAgICByZW1vdGUuYXBwLmV4aXQoMCk7XG4gIH1cblxuICBhc3luYyBmdW5jdGlvbiBjb3B5VXBzdHJlYW1SZXBvVVJMKCkge1xuICAgIGNsaXBib2FyZC53cml0ZVRleHQodXBzdHJlYW1VUkwpO1xuICB9XG5cbiAgYXN5bmMgZnVuY3Rpb24gZmV0Y2hSZXBvQ29uZmlnKCkge1xuICAgIGNvbnN0IHJlcG9DZmcgPSBhd2FpdCByZXF1ZXN0PFJlcG9Db25maWc+KCdnaXQtY29uZmlnJyk7XG4gICAgdXBkYXRlUmVwb0NmZyhyZXBvQ2ZnKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNsb3NlV2luZG93KCkge1xuICAgIHJlbW90ZS5nZXRDdXJyZW50V2luZG93KCkuaGlkZSgpO1xuICB9XG5cbiAgcmV0dXJuIChcbiAgICA8ZGl2IGNsYXNzTmFtZT17c3R5bGVzLmRhdGFTeW5jQmFzZX0+XG4gICAgICA8QnV0dG9uIGRpc2FibGVkPXshcmVwb0NvbmZpZ0NvbXBsZXRlfSBvbkNsaWNrPXsoKSA9PiB1cGRhdGVSZXBvQ29uZmlnT3BlblN0YXRlKCFyZXBvQ29uZmlnT3BlblN0YXRlKX0+XG4gICAgICAgIHtyZXBvQ29uZmlnQ29tcGxldGUgJiYgcmVwb0NvbmZpZ09wZW5TdGF0ZSA/ICdIaWRlIHInIDogJ1InfVxuICAgICAgICBlcG9zaXRvcnkgY29uZmlndXJhdGlvblxuICAgICAgICB7IXJlcG9Db25maWdPcGVuU3RhdGUgJiYgcmVwb0NvbmZpZ0NvbXBsZXRlID8gJ+KApic6IG51bGx9XG4gICAgICA8L0J1dHRvbj5cblxuICAgICAgPENhcmQga2V5PVwicmVwb1VybFwiIGNsYXNzTmFtZT17c3R5bGVzLnJlcG9VcmxDYXJkfT5cbiAgICAgICAgPEZvcm1Hcm91cFxuICAgICAgICAgICAgbGFiZWw9XCJSZXBvc2l0b3J5IFVSTFwiXG4gICAgICAgICAgICBpbnRlbnQ9e2luUHJlTGF1bmNoU2V0dXAgJiYgIXVybElzVmFsaWQgPyBcImRhbmdlclwiIDogdW5kZWZpbmVkfVxuICAgICAgICAgICAgaGVscGVyVGV4dD17aW5QcmVMYXVuY2hTZXR1cFxuICAgICAgICAgICAgICA/IDxDYWxsb3V0IGludGVudD1cInByaW1hcnlcIj5cbiAgICAgICAgICAgICAgICAgIDxwPlxuICAgICAgICAgICAgICAgICAgICBQbGVhc2UgZW50ZXIgYSB2YWxpZCBVUkwgb2YgdGhlIHJlcG9zaXRvcnkgeW91IGhhdmUgY29tbWl0IGFjY2VzcyB0byxcbiAgICAgICAgICAgICAgICAgICAgYW5kIHdoaWNoIGlzIGEgZm9yayBvZiB0aGUgdXBzdHJlYW0gcmVwb3NpdG9yeS5cbiAgICAgICAgICAgICAgICAgIDwvcD5cbiAgICAgICAgICAgICAgICAgIDxwPlxuICAgICAgICAgICAgICAgICAgICA8QnV0dG9uIG9uQ2xpY2s9e2NvcHlVcHN0cmVhbVJlcG9VUkx9PkNvcHkgdXBzdHJlYW0gcmVwb3NpdG9yeSBVUkw8L0J1dHRvbj5cbiAgICAgICAgICAgICAgICAgIDwvcD5cbiAgICAgICAgICAgICAgICA8L0NhbGxvdXQ+XG4gICAgICAgICAgICAgIDogPENhbGxvdXQgaW50ZW50PVwid2FybmluZ1wiPlxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgTm90ZTogcmVzZXR0aW5nIHRoZSBVUkwgd2lsbCBjYXVzZSB5b3UgdG8gbG9zZSBhbnkgdW5zdWJtaXR0ZWQgY2hhbmdlcy5cbiAgICAgICAgICAgICAgICA8L0NhbGxvdXQ+fT5cbiAgICAgICAgICA8SW5wdXRHcm91cFxuICAgICAgICAgICAgdmFsdWU9e3VybC52YWx1ZX1cbiAgICAgICAgICAgIHBsYWNlaG9sZGVyPXt1cHN0cmVhbVVSTH1cbiAgICAgICAgICAgIGRpc2FibGVkPXtpblByZUxhdW5jaFNldHVwICE9PSB0cnVlfVxuICAgICAgICAgICAgdHlwZT1cInRleHRcIlxuICAgICAgICAgICAgb25DaGFuZ2U9e2luUHJlTGF1bmNoU2V0dXBcbiAgICAgICAgICAgICAgPyAoZXZ0OiBSZWFjdC5Gb3JtRXZlbnQ8SFRNTEVsZW1lbnQ+KSA9PiB7XG4gICAgICAgICAgICAgICAgdXJsLnNldCgoZXZ0LnRhcmdldCBhcyBIVE1MSW5wdXRFbGVtZW50KS52YWx1ZSBhcyBzdHJpbmcpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIDogdW5kZWZpbmVkfVxuICAgICAgICAgICAgcmlnaHRFbGVtZW50PXtpblByZUxhdW5jaFNldHVwXG4gICAgICAgICAgICAgID8gdW5kZWZpbmVkXG4gICAgICAgICAgICAgIDogPEJ1dHRvblxuICAgICAgICAgICAgICAgICAgICBpbnRlbnQ9XCJkYW5nZXJcIlxuICAgICAgICAgICAgICAgICAgICBtaW5pbWFsPXt0cnVlfVxuICAgICAgICAgICAgICAgICAgICB0aXRsZT1cIlJlc2V0IHJlcG9zaXRvcnkgVVJMLiBOb3RlOiB5b3Ugd2lsbCBsb3NlIGFueSB1bnN1Ym1pdHRlZCBjaGFuZ2VzLlwiXG4gICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e2hhbmRsZVJlc2V0VVJMfT5cbiAgICAgICAgICAgICAgICAgIFJlc2V0IFVSTFxuICAgICAgICAgICAgICAgIDwvQnV0dG9uPn1cbiAgICAgICAgICAvPlxuICAgICAgICA8L0Zvcm1Hcm91cD5cbiAgICAgIDwvQ2FyZD5cblxuICAgICAgPENhcmQga2V5PVwiY29tbWl0dGVySW5mb1wiIGNsYXNzTmFtZT17c3R5bGVzLmNvbW1pdHRlckluZm9DYXJkfT5cbiAgICAgICAgPEg0PkNvbW1pdHRpbmcgY2hhbmdlcyBhczwvSDQ+XG5cbiAgICAgICAgPGRpdiBjbGFzc05hbWU9e3N0eWxlcy5kYXRhU3luY1Jvd30+XG4gICAgICAgICAgPExhYmVsIGtleT1cImF1dGhvck5hbWVcIj5cbiAgICAgICAgICAgIEF1dGhvciBuYW1lXG4gICAgICAgICAgICA8SW5wdXRHcm91cFxuICAgICAgICAgICAgICB2YWx1ZT17bmFtZX1cbiAgICAgICAgICAgICAgdHlwZT1cInRleHRcIlxuICAgICAgICAgICAgICBvbkNoYW5nZT17KGV2dDogUmVhY3QuRm9ybUV2ZW50PEhUTUxFbGVtZW50PikgPT4ge1xuICAgICAgICAgICAgICAgIHNldE5hbWUoKGV2dC50YXJnZXQgYXMgSFRNTElucHV0RWxlbWVudCkudmFsdWUgYXMgc3RyaW5nKTtcbiAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgPC9MYWJlbD5cblxuICAgICAgICAgIDxMYWJlbCBrZXk9XCJhdXRob3JFbWFpbFwiPlxuICAgICAgICAgICAgQXV0aG9yIGVtYWlsXG4gICAgICAgICAgICA8SW5wdXRHcm91cFxuICAgICAgICAgICAgICB2YWx1ZT17ZW1haWx9XG4gICAgICAgICAgICAgIHR5cGU9XCJlbWFpbFwiXG4gICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZXZ0OiBSZWFjdC5Gb3JtRXZlbnQ8SFRNTEVsZW1lbnQ+KSA9PiB7XG4gICAgICAgICAgICAgICAgc2V0RW1haWwoKGV2dC50YXJnZXQgYXMgSFRNTElucHV0RWxlbWVudCkudmFsdWUgYXMgc3RyaW5nKTtcbiAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgPC9MYWJlbD5cblxuICAgICAgICAgIDxMYWJlbCBrZXk9XCJ1c2VybmFtZVwiPlxuICAgICAgICAgICAgVXNlcm5hbWVcbiAgICAgICAgICAgIDxJbnB1dEdyb3VwXG4gICAgICAgICAgICAgIHZhbHVlPXt1c2VybmFtZX1cbiAgICAgICAgICAgICAgdHlwZT1cInRleHRcIlxuICAgICAgICAgICAgICBvbkNoYW5nZT17KGV2dDogUmVhY3QuRm9ybUV2ZW50PEhUTUxFbGVtZW50PikgPT4ge1xuICAgICAgICAgICAgICAgIHNldFVzZXJuYW1lKChldnQudGFyZ2V0IGFzIEhUTUxJbnB1dEVsZW1lbnQpLnZhbHVlIGFzIHN0cmluZyk7XG4gICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAvPlxuICAgICAgICAgIDwvTGFiZWw+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9DYXJkPlxuXG4gICAgICA8Q2FyZCBrZXk9XCJhY3Rpb25Sb3dcIiBjbGFzc05hbWU9e3N0eWxlcy5hY3Rpb25Sb3dDYXJkfT5cbiAgICAgICAgPEJ1dHRvblxuICAgICAgICAgICAgY2xhc3NOYW1lPVwiY29uZmlybS1idXR0b25cIlxuICAgICAgICAgICAga2V5PVwiY29uZmlybVwiXG4gICAgICAgICAgICBpbnRlbnQ9eyF1c2luZ1Vwc3RyZWFtID8gXCJwcmltYXJ5XCIgOiBcIndhcm5pbmdcIn1cbiAgICAgICAgICAgIGRpc2FibGVkPXtjb21wbGV0ZSAhPT0gdHJ1ZX1cbiAgICAgICAgICAgIG9uQ2xpY2s9e2hhbmRsZVNhdmVBbmRDbG9zZX0+XG4gICAgICAgICAgU2F2ZSB7IXVzaW5nVXBzdHJlYW0gPyBcInVwc3RyZWFtXCIgOiBcImZvcmtcIn0gY29uZmlndXJhdGlvblxuICAgICAgICAgIHtpblByZUxhdW5jaFNldHVwID8gXCIgYW5kIGxhdW5jaFwiIDogXCIgYW5kIGNsb3NlXCJ9XG4gICAgICAgIDwvQnV0dG9uPlxuICAgICAgPC9DYXJkPlxuICAgIDwvZGl2PlxuICApO1xufTtcbiJdfQ==