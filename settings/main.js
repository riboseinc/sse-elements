import * as fs from 'fs-extra';
import * as log from 'electron-log';
import { ipcMain } from 'electron';
import { YAMLStorage } from '../storage/main/yaml';
export class Setting {
    constructor(id, label, paneId) {
        this.id = id;
        this.label = label;
        this.paneId = paneId;
    }
    toUseable(val) { return val; }
    ;
    toStoreable(val) { return val; }
    ;
}
export class SettingManager {
    constructor(settingsPath) {
        this.settingsPath = settingsPath;
        this.registry = [];
        this.panes = [];
        this.data = null;
        log.debug(`SSE: Settings: Configuring settings with path ${settingsPath}`);
        this.yaml = new YAMLStorage(fs);
    }
    async getValue(id) {
        const setting = this.get(id);
        if (setting) {
            if (this.data === null) {
                let settingsFileExists;
                try {
                    settingsFileExists = (await fs.stat(this.settingsPath)).isFile();
                }
                catch (e) {
                    settingsFileExists = false;
                }
                if (settingsFileExists) {
                    this.data = (await this.yaml.load(this.settingsPath)) || {};
                }
                else {
                    this.data = {};
                }
            }
            const rawVal = this.data[id];
            return rawVal !== undefined ? setting.toUseable(rawVal) : undefined;
        }
        else {
            log.warn(`SSE: Settings: Attempted to get value for non-existent setting ${id}`);
            throw new Error(`Setting to get value for is not found: ${id}`);
        }
    }
    async setValue(id, val) {
        // DANGER: Never log settingâ€™s val in raw form
        log.debug(`SSE: Settings: Set value for setting ${id}`);
        const setting = this.get(id);
        if (setting) {
            const storeable = setting.toStoreable(val);
            this.data[id] = storeable;
            await this.commit();
        }
        else {
            throw new Error(`Setting to set value for is not found: ${id}`);
        }
    }
    async deleteValue(id) {
        log.debug(`SSE: Settings: Delete setting: ${id}`);
        delete this.data[id];
        await this.commit();
    }
    async commit() {
        log.info("SSE: Settings: Commit new settings");
        log.debug("SSE: Settings: Commit: Remove file");
        await fs.remove(this.settingsPath);
        log.debug("SSE: Settings: Commit: Write new file");
        await this.yaml.store(this.settingsPath, this.data);
    }
    get(id) {
        return this.registry.find(s => s.id === id);
    }
    register(setting) {
        log.debug("SSE: Settings: Register setting");
        if (this.panes.find(p => p.id === setting.paneId)) {
            this.registry.push(setting);
        }
        else {
            throw new Error("Invalid pane ID");
        }
    }
    configurePane(pane) {
        this.panes.push(pane);
    }
    setUpAPIEndpoints() {
        log.verbose("SSE: Settings: Configure API endpoints");
        ipcMain.on('set-setting', async (evt, name, value) => {
            return await this.setValue(name, value);
        });
        ipcMain.on('get-setting', async (evt, name) => {
            const value = await this.getValue(name);
            evt.reply('get-setting', name, value);
        });
        ipcMain.on('clear-setting', async (evt, name) => {
            log.debug(`SSE: Settings: received clear-setting request for ${name}`);
            await this.deleteValue(name);
            evt.reply('clear-setting', 'ok');
        });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zZXR0aW5ncy9tYWluLnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEtBQUssRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUMvQixPQUFPLEtBQUssR0FBRyxNQUFNLGNBQWMsQ0FBQztBQUVwQyxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sVUFBVSxDQUFDO0FBRW5DLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQVVuRCxNQUFNLE9BQU8sT0FBTztJQUNsQixZQUNTLEVBQVUsRUFDVixLQUFhLEVBQ2IsTUFBYztRQUZkLE9BQUUsR0FBRixFQUFFLENBQVE7UUFDVixVQUFLLEdBQUwsS0FBSyxDQUFRO1FBQ2IsV0FBTSxHQUFOLE1BQU0sQ0FBUTtJQUFHLENBQUM7SUFDM0IsU0FBUyxDQUFDLEdBQVksSUFBTyxPQUFPLEdBQVEsQ0FBQSxDQUFDLENBQUM7SUFBQSxDQUFDO0lBQy9DLFdBQVcsQ0FBQyxHQUFNLElBQVMsT0FBTyxHQUFVLENBQUEsQ0FBQyxDQUFDO0lBQUEsQ0FBQztDQUNoRDtBQUdELE1BQU0sT0FBTyxjQUFjO0lBTXpCLFlBQW1CLFlBQW9CO1FBQXBCLGlCQUFZLEdBQVosWUFBWSxDQUFRO1FBTC9CLGFBQVEsR0FBbUIsRUFBRSxDQUFDO1FBQzlCLFVBQUssR0FBVyxFQUFFLENBQUM7UUFDbkIsU0FBSSxHQUFlLElBQUksQ0FBQztRQUk5QixHQUFHLENBQUMsS0FBSyxDQUFDLGlEQUFpRCxZQUFZLEVBQUUsQ0FBQyxDQUFDO1FBQzNFLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxXQUFXLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDbEMsQ0FBQztJQUVNLEtBQUssQ0FBQyxRQUFRLENBQUMsRUFBVTtRQUM5QixNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBRTdCLElBQUksT0FB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R0FBRyxDQUFDLEtBQUssQ0FBQyxlQUFlLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDbkMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBmcyBmcm9tICdmcy1leHRyYSc7XG5pbXBvcnQgKiBhcyBsb2cgZnJvbSAnZWxlY3Ryb24tbG9nJztcblxuaW1wb3J0IHsgaXBjTWFpbiB9IGZyb20gJ2VsZWN0cm9uJztcblxuaW1wb3J0IHsgWUFNTFN0b3JhZ2UgfSBmcm9tICcuLi9zdG9yYWdlL21haW4veWFtbCc7XG5cblxuZXhwb3J0IGludGVyZmFjZSBQYW5lIHtcbiAgaWQ6IHN0cmluZztcbiAgbGFiZWw6IHN0cmluZztcbiAgaWNvbj86IHN0cmluZztcbn1cblxuXG5leHBvcnQgY2xhc3MgU2V0dGluZzxUPiB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIHB1YmxpYyBpZDogc3RyaW5nLFxuICAgIHB1YmxpYyBsYWJlbDogc3RyaW5nLFxuICAgIHB1YmxpYyBwYW5lSWQ6IHN0cmluZykge31cbiAgdG9Vc2VhYmxlKHZhbDogdW5rbm93bik6IFQgeyByZXR1cm4gdmFsIGFzIFQgfTtcbiAgdG9TdG9yZWFibGUodmFsOiBUKTogYW55IHsgcmV0dXJuIHZhbCBhcyBhbnkgfTtcbn1cblxuXG5leHBvcnQgY2xhc3MgU2V0dGluZ01hbmFnZXIge1xuICBwcml2YXRlIHJlZ2lzdHJ5OiBTZXR0aW5nPGFueT5bXSA9IFtdO1xuICBwcml2YXRlIHBhbmVzOiBQYW5lW10gPSBbXTtcbiAgcHJpdmF0ZSBkYXRhOiBhbnkgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSB5YW1sOiBZQU1MU3RvcmFnZTtcblxuICBjb25zdHJ1Y3RvcihwdWJsaWMgc2V0dGluZ3NQYXRoOiBzdHJpbmcpIHtcbiAgICBsb2cuZGVidWcoYFNTRTogU2V0dGluZ3M6IENvbmZpZ3VyaW5nIHNldHRpbmdzIHdpdGggcGF0aCAke3NldHRpbmdzUGF0aH1gKTtcbiAgICB0aGlzLnlhbWwgPSBuZXcgWUFNTFN0b3JhZ2UoZnMpO1xuICB9XG5cbiAgcHVibGljIGFzeW5jIGdldFZhbHVlKGlkOiBzdHJpbmcpOiBQcm9taXNlPHVua25vd24+IHtcbiAgICBjb25zdCBzZXR0aW5nID0gdGhpcy5nZXQoaWQpO1xuXG4gICAgaWYgKHNldHRpbmcpIHtcbiAgICAgIGlmICh0aGlzLmRhdGEgPT09IG51bGwpIHtcbiAgICAgICAgbGV0IHNldHRpbmdzRmlsZUV4aXN0czogYm9vbGVhbjtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBzZXR0aW5nc0ZpbGVFeGlzdHMgPSAoYXdhaXQgZnMuc3RhdCh0aGlzLnNldHRpbmdzUGF0aCkpLmlzRmlsZSgpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgc2V0dGluZ3NGaWxlRXhpc3RzID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNldHRpbmdzRmlsZUV4aXN0cykge1xuICAgICAgICAgIHRoaXMuZGF0YSA9IChhd2FpdCB0aGlzLnlhbWwubG9hZCh0aGlzLnNldHRpbmdzUGF0aCkpIHx8IHt9O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuZGF0YSA9IHt9O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBjb25zdCByYXdWYWwgPSB0aGlzLmRhdGFbaWRdO1xuICAgICAgcmV0dXJuIHJhd1ZhbCAhPT0gdW5kZWZpbmVkID8gc2V0dGluZy50b1VzZWFibGUocmF3VmFsKSA6IHVuZGVmaW5lZDtcbiAgICB9IGVsc2Uge1xuICAgICAgbG9nLndhcm4oYFNTRTogU2V0dGluZ3M6IEF0dGVtcHRlZCB0byBnZXQgdmFsdWUgZm9yIG5vbi1leGlzdGVudCBzZXR0aW5nICR7aWR9YCk7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFNldHRpbmcgdG8gZ2V0IHZhbHVlIGZvciBpcyBub3QgZm91bmQ6ICR7aWR9YCk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGFzeW5jIHNldFZhbHVlKGlkOiBzdHJpbmcsIHZhbDogdW5rbm93bikge1xuICAgIC8vIERBTkdFUjogTmV2ZXIgbG9nIHNldHRpbmfigJlzIHZhbCBpbiByYXcgZm9ybVxuXG4gICAgbG9nLmRlYnVnKGBTU0U6IFNldHRpbmdzOiBTZXQgdmFsdWUgZm9yIHNldHRpbmcgJHtpZH1gKTtcblxuICAgIGNvbnN0IHNldHRpbmcgPSB0aGlzLmdldChpZCk7XG4gICAgaWYgKHNldHRpbmcpIHtcbiAgICAgIGNvbnN0IHN0b3JlYWJsZSA9IHNldHRpbmcudG9TdG9yZWFibGUodmFsKTtcbiAgICAgIHRoaXMuZGF0YVtpZF0gPSBzdG9yZWFibGU7XG4gICAgICBhd2FpdCB0aGlzLmNvbW1pdCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFNldHRpbmcgdG8gc2V0IHZhbHVlIGZvciBpcyBub3QgZm91bmQ6ICR7aWR9YCk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGFzeW5jIGRlbGV0ZVZhbHVlKGlkOiBzdHJpbmcpIHtcbiAgICBsb2cuZGVidWcoYFNTRTogU2V0dGluZ3M6IERlbGV0ZSBzZXR0aW5nOiAke2lkfWApO1xuICAgIGRlbGV0ZSB0aGlzLmRhdGFbaWRdO1xuICAgIGF3YWl0IHRoaXMuY29tbWl0KCk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGNvbW1pdCgpIHtcbiAgICBsb2cuaW5mbyhcIlNTRTogU2V0dGluZ3M6IENvbW1pdCBuZXcgc2V0dGluZ3NcIik7XG4gICAgbG9nLmRlYnVnKFwiU1NFOiBTZXR0aW5nczogQ29tbWl0OiBSZW1vdmUgZmlsZVwiKTtcbiAgICBhd2FpdCBmcy5yZW1vdmUodGhpcy5zZXR0aW5nc1BhdGgpO1xuICAgIGxvZy5kZWJ1ZyhcIlNTRTogU2V0dGluZ3M6IENvbW1pdDogV3JpdGUgbmV3IGZpbGVcIik7XG4gICAgYXdhaXQgdGhpcy55YW1sLnN0b3JlKHRoaXMuc2V0dGluZ3NQYXRoLCB0aGlzLmRhdGEpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXQoaWQ6IHN0cmluZyk6IFNldHRpbmc8YW55PiB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMucmVnaXN0cnkuZmluZChzID0+IHMuaWQgPT09IGlkKTtcbiAgfVxuXG4gIHB1YmxpYyByZWdpc3RlcihzZXR0aW5nOiBTZXR0aW5nPGFueT4pIHtcbiAgICBsb2cuZGVidWcoXCJTU0U6IFNldHRpbmdzOiBSZWdpc3RlciBzZXR0aW5nXCIpO1xuICAgIGlmICh0aGlzLnBhbmVzLmZpbmQocCA9PiBwLmlkID09PSBzZXR0aW5nLnBhbmVJZCkpIHtcbiAgICAgIHRoaXMucmVnaXN0cnkucHVzaChzZXR0aW5nKTtcblxuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHBhbmUgSURcIik7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGNvbmZpZ3VyZVBhbmUocGFuZTogUGFuZSkge1xuICAgIHRoaXMucGFuZXMucHVzaChwYW5lKTtcbiAgfVxuXG4gIHB1YmxpYyBzZXRVcEFQSUVuZHBvaW50cygpIHtcbiAgICBsb2cudmVyYm9zZShcIlNTRTogU2V0dGluZ3M6IENvbmZpZ3VyZSBBUEkgZW5kcG9pbnRzXCIpO1xuXG4gICAgaXBjTWFpbi5vbignc2V0LXNldHRpbmcnLCBhc3luYyAoZXZ0OiBhbnksIG5hbWU6IHN0cmluZywgdmFsdWU6IGFueSkgPT4ge1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuc2V0VmFsdWUobmFtZSwgdmFsdWUpO1xuICAgIH0pO1xuXG4gICAgaXBjTWFpbi5vbignZ2V0LXNldHRpbmcnLCBhc3luYyAoZXZ0OiBhbnksIG5hbWU6IHN0cmluZykgPT4ge1xuICAgICAgY29uc3QgdmFsdWUgPSBhd2FpdCB0aGlzLmdldFZhbHVlKG5hbWUpO1xuICAgICAgZXZ0LnJlcGx5KCdnZXQtc2V0dGluZycsIG5hbWUsIHZhbHVlKTtcbiAgICB9KTtcblxuICAgIGlwY01haW4ub24oJ2NsZWFyLXNldHRpbmcnLCBhc3luYyAoZXZ0OiBhbnksIG5hbWU6IHN0cmluZykgPT4ge1xuICAgICAgbG9nLmRlYnVnKGBTU0U6IFNldHRpbmdzOiByZWNlaXZlZCBjbGVhci1zZXR0aW5nIHJlcXVlc3QgZm9yICR7bmFtZX1gKTtcblxuICAgICAgYXdhaXQgdGhpcy5kZWxldGVWYWx1ZShuYW1lKTtcbiAgICAgIGV2dC5yZXBseSgnY2xlYXItc2V0dGluZycsICdvaycpO1xuICAgIH0pO1xuICB9XG59XG4iXX0=